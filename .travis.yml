language: python
sudo: false
python:
  - "2.7"
  - "3.4"
install:
  - "pip install ."
script: py.test src/geventhttpclient/tests

jobs:
  include:
    - stage: build
      sudo: required
      services:
        - docker
      os: linux
      python: "3.6"
      script:
        - pip install cibuildwheel==0.6.0
        - cibuildwheel --output-dir wheelhouse
    - stage: build
      sudo: required
      services:
        - docker
      os: osx
      osx_image: xcode8.3
      install:
        # Python 3 is needed to run cibuildwheel
        - if [ "${TRAVIS_OS_NAME:-}" == "osx" ]; then
            brew update;
            brew install python3;
          fi
        - pip3 install cibuildwheel==0.6.0
      script:
        - cibuildwheel --output-dir wheelhouse
